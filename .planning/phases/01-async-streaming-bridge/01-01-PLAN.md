---
phase: 01-async-streaming-bridge
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - src/tui/__init__.py
  - tests/tui/__init__.py
autonomous: true
requirements: [AGENT-03, AGENT-04]

must_haves:
  truths:
    - "pytest discovers and runs async tests without manual asyncio.run() wrappers"
    - "src/tui/ is importable as a Python package (import tui succeeds)"
    - "tests/tui/ is a valid test directory pytest can collect from"
  artifacts:
    - path: "pyproject.toml"
      provides: "pytest-asyncio dev dependency and asyncio_mode=auto config"
      contains: "pytest-asyncio"
    - path: "src/tui/__init__.py"
      provides: "tui package entry point"
    - path: "tests/tui/__init__.py"
      provides: "test package entry point for bridge tests"
  key_links:
    - from: "pyproject.toml"
      to: "pytest-asyncio"
      via: "project.optional-dependencies.dev"
      pattern: "pytest-asyncio"
    - from: "pyproject.toml"
      to: "asyncio_mode"
      via: "tool.pytest.ini_options"
      pattern: "asyncio_mode.*auto"
---

<objective>
Create the tui package skeleton and configure pytest-asyncio so Phase 1 TDD tests can run.

Purpose: The bridge TDD plan (01-02) requires that `import tui` works and that `async def test_*` functions run as asyncio coroutines without explicit decorators. This setup plan provides that foundation.
Output: Updated pyproject.toml with pytest-asyncio dev dep and asyncio_mode config; src/tui/__init__.py; tests/tui/__init__.py.
</objective>

<execution_context>
@/Users/jakeogden/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jakeogden/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-async-streaming-bridge/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update pyproject.toml — add pytest-asyncio and rename project</name>
  <files>pyproject.toml</files>
  <action>
    Edit pyproject.toml to make the following changes:

    1. Rename project: change `name = "disagree-v1"` to `name = "agent-bureau"` (per research recommendation — the product is now agent-bureau, not disagree-v1).

    2. Add pytest-asyncio to dev dependencies:
       Change: `dev = ["pytest>=8.0"]`
       To: `dev = ["pytest>=8.0", "pytest-asyncio>=0.25,<2.0"]`

    3. Update [tool.pytest.ini_options] to add asyncio config:
       Add these two lines under the existing options:
       ```toml
       asyncio_mode = "auto"
       asyncio_default_fixture_loop_scope = "function"
       ```
       The existing `pythonpath = ["src"]` and `addopts = "-q"` stay unchanged.

    Final [tool.pytest.ini_options] section should be:
    ```toml
    [tool.pytest.ini_options]
    pythonpath = ["src"]
    addopts = "-q"
    asyncio_mode = "auto"
    asyncio_default_fixture_loop_scope = "function"
    ```

    Do NOT add Textual, rich, or any runtime dependencies — Phase 1 is stdlib only.
  </action>
  <verify>
    Run: `python3 -c "import tomllib; d = tomllib.load(open('pyproject.toml','rb')); print(d['project']['name']); print(d['tool']['pytest.ini_options']['asyncio_mode'])"`
    Expected: prints "agent-bureau" and "auto"
    Also run: `cat pyproject.toml` and confirm both new lines are present.
  </verify>
  <done>pyproject.toml has name="agent-bureau", pytest-asyncio in dev deps, asyncio_mode="auto", and asyncio_default_fixture_loop_scope="function" in pytest options.</done>
</task>

<task type="auto">
  <name>Task 2: Create tui package skeleton</name>
  <files>
    src/tui/__init__.py
    tests/tui/__init__.py
  </files>
  <action>
    Create two empty `__init__.py` files to establish the tui package and its test counterpart.

    1. Create `src/tui/__init__.py` — empty file (or single comment: `# tui package`). This makes `src/tui/` a Python package importable as `tui` (given pythonpath = ["src"] in pyproject.toml).

    2. Create `tests/tui/__init__.py` — empty file. This makes `tests/tui/` a pytest collection directory. Note: `tests/` already exists (it contains `test_v1_flow.py`). Do NOT touch `tests/test_v1_flow.py` or anything in `src/disagree_v1/`.

    Do NOT create event_bus.py or bridge.py yet — those belong in Plan 02 (TDD plan).
    Do NOT create test_bridge.py yet — that belongs in Plan 02.
  </action>
  <verify>
    Run from project root:
    ```bash
    PYTHONPATH=src python3 -c "import tui; print('tui imported OK')"
    pip install -e ".[dev]" --quiet
    python3 -m pytest tests/ --collect-only -q 2>&1 | head -20
    ```
    Expected:
    - "tui imported OK" printed with no errors
    - pytest collects existing tests/test_v1_flow.py tests (existing tests must still pass)
    - No import errors for tui package
  </verify>
  <done>
    `import tui` succeeds from PYTHONPATH=src. tests/tui/ is collected by pytest. Existing tests/test_v1_flow.py tests all pass (no regressions).
  </done>
</task>

</tasks>

<verification>
After both tasks:
1. `pip install -e ".[dev]"` installs pytest-asyncio without errors
2. `python3 -m pytest tests/ -q` — all existing tests pass, no collection errors
3. `python3 -c "import tui"` exits 0
4. pyproject.toml has `asyncio_mode = "auto"` — confirmed by grep
5. No files in src/disagree_v1/ were modified
</verification>

<success_criteria>
- pyproject.toml updated: project renamed to agent-bureau, pytest-asyncio added, asyncio_mode configured
- src/tui/__init__.py exists
- tests/tui/__init__.py exists
- All existing tests in tests/test_v1_flow.py continue to pass
- `import tui` works from PYTHONPATH=src
</success_criteria>

<output>
After completion, create `.planning/phases/01-async-streaming-bridge/01-01-SUMMARY.md` with:
- What was changed (pyproject.toml diff summary, files created)
- Project name: agent-bureau
- pytest-asyncio version pinned: >=0.25,<2.0
- asyncio_mode: auto
- asyncio_default_fixture_loop_scope: function
- Any issues encountered
</output>
