---
phase: 03-live-streaming-integration
plan: "03"
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/tui/widgets/status_bar.py
  - src/tui/widgets/prompt_bar.py
  - src/tui/widgets/__init__.py
  - src/tui/styles.tcss
autonomous: true
requirements: [TUI-09]

must_haves:
  truths:
    - "StatusBar widget displays keyboard hints in IDLE state and streaming state text on update"
    - "PromptBar widget wraps Input with compact=True, an id, and is disabled/enabled cleanly"
    - "styles.tcss defines #status-bar, #prompt-bar, and AgentPane.disagreement #header rules"
    - "StatusBar and PromptBar are exported from tui.widgets"
  artifacts:
    - path: "src/tui/widgets/status_bar.py"
      provides: "StatusBar(Static) widget with update_status() method"
      exports: ["StatusBar"]
    - path: "src/tui/widgets/prompt_bar.py"
      provides: "PromptBar(Widget) wrapping Input"
      exports: ["PromptBar"]
    - path: "src/tui/widgets/__init__.py"
      provides: "Updated exports including StatusBar and PromptBar"
    - path: "src/tui/styles.tcss"
      provides: "CSS rules for status bar, prompt bar, disagreement highlight"
  key_links:
    - from: "src/tui/widgets/status_bar.py"
      to: "textual.widgets.Static"
      via: "StatusBar inherits Static; uses Static.update() for text changes"
      pattern: "class StatusBar\\(Static\\)"
    - from: "src/tui/widgets/prompt_bar.py"
      to: "textual.widgets.Input"
      via: "PromptBar.compose() yields Input with id=prompt-input"
      pattern: "yield Input"
    - from: "src/tui/styles.tcss"
      to: "AgentPane.disagreement"
      via: "CSS class selector applied by set_disagreement_highlight()"
      pattern: "AgentPane\\.disagreement"
---

<objective>
Create the StatusBar and PromptBar widgets and extend styles.tcss with the rules needed for Phase 3 layout. These are pure widget-building tasks with no business logic — no TDD needed.

Purpose: The status bar (TUI-09) and prompt bar are the two new UI components added in Phase 3. They must exist as standalone widgets before AgentBureauApp can compose them. Adding the CSS rules here keeps styles centralized in styles.tcss.

Output: `status_bar.py`, `prompt_bar.py`, updated `__init__.py`, and extended `styles.tcss`.
</objective>

<execution_context>
@/Users/jakeogden/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jakeogden/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-live-streaming-integration/03-RESEARCH.md
@.planning/phases/03-live-streaming-integration/03-01-SUMMARY.md
@src/tui/styles.tcss
@src/tui/widgets/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: StatusBar and PromptBar widgets</name>
  <files>
    src/tui/widgets/status_bar.py
    src/tui/widgets/prompt_bar.py
    src/tui/widgets/__init__.py
  </files>
  <action>
Create two new widget files. Read `src/tui/widgets/__init__.py` first.

**src/tui/widgets/status_bar.py**:

```python
"""StatusBar widget — one-line top bar showing session state and keyboard hints."""
from __future__ import annotations

from textual.widgets import Static

# Default text shown before the first prompt is submitted.
_INITIAL_TEXT = "Enter: submit  •  Ctrl-C: quit  •  Ctrl-L: clear"


class StatusBar(Static):
    """A one-line status bar at the top of the screen.

    Displays keyboard hints in IDLE state. Updated via update_status()
    when agent streaming state or classification results change.

    Uses Static.update() (inherited) for all text changes — no reactive
    needed; updates are driven by explicit calls from AgentBureauApp.
    """

    DEFAULT_CSS = """
    StatusBar {
        height: 1;
        background: $panel-darken-2;
        color: $text-muted;
        content-align: left middle;
        padding: 0 1;
    }
    """

    def __init__(self, **kwargs) -> None:
        super().__init__(_INITIAL_TEXT, **kwargs)

    def show_hints(self) -> None:
        """Restore keyboard hint text (IDLE state)."""
        self.update(_INITIAL_TEXT)

    def show_streaming(self, agent_counts: dict[str, int]) -> None:
        """Update text while agents are streaming.

        Args:
            agent_counts: {agent_name: line_count} for all active agents.
        """
        parts = [f"{name}: streaming ({count} lines)" for name, count in agent_counts.items()]
        self.update("  •  ".join(parts))

    def show_done(self, agent_counts: dict[str, int]) -> None:
        """Update text when all agents have finished (before classification)."""
        parts = [f"{name}: {count} lines" for name, count in agent_counts.items()]
        self.update("Both done — " + ", ".join(parts))

    def show_classification(self, agent_counts: dict[str, int], disagreements: list) -> None:
        """Update text after classification completes.

        Args:
            agent_counts: {agent_name: line_count}
            disagreements: list[Disagreement] from classify_disagreements()
        """
        done_part = ", ".join(f"{name}: {count} lines" for name, count in agent_counts.items())
        if disagreements:
            kinds = ", ".join(d.kind for d in disagreements)
            classification_part = f"disagreement: {kinds}"
        else:
            classification_part = "agents agree"
        self.update(f"Both done — {done_part}  •  {classification_part}")
```

**src/tui/widgets/prompt_bar.py**:

```python
"""PromptBar widget — one-line input bar at the bottom of the screen."""
from __future__ import annotations

from textual.app import ComposeResult
from textual.widget import Widget
from textual.widgets import Input


class PromptBar(Widget):
    """A one-line prompt input bar at the bottom of the screen.

    Wraps a Textual Input widget with compact=True (no border).
    Disabled while agents are streaming; re-enabled and focused after
    each session completes.

    AgentBureauApp handles Input.Submitted directly — PromptBar is a
    pure layout/containment widget.
    """

    DEFAULT_CSS = """
    PromptBar {
        height: 1;
        background: $surface-darken-1;
        dock: bottom;
    }
    PromptBar Input {
        background: $surface-darken-1;
        border: none;
        height: 1;
    }
    """

    def compose(self) -> ComposeResult:
        yield Input(
            placeholder="Enter a prompt and press Enter...",
            id="prompt-input",
            compact=True,
        )
```

**Update src/tui/widgets/__init__.py** — add StatusBar and PromptBar to exports:

Read the current file first. Add imports for StatusBar and PromptBar alongside the existing AgentPane and QuitScreen exports.
  </action>
  <verify>
`.venv/bin/python -c "from tui.widgets.status_bar import StatusBar; from tui.widgets.prompt_bar import PromptBar; from tui.widgets import StatusBar, PromptBar; print('OK')"` outputs OK.
`.venv/bin/pytest` exits 0 with no regressions.
  </verify>
  <done>StatusBar and PromptBar importable from tui.widgets. Full test suite passes. Commit: `feat(03-03): add StatusBar and PromptBar widgets`</done>
</task>

<task type="auto">
  <name>Task 2: Extend styles.tcss with Phase 3 layout rules</name>
  <files>
    src/tui/styles.tcss
  </files>
  <action>
Read the existing `src/tui/styles.tcss` first. Append the following new rules at the end of the file. Do NOT modify any existing rules.

```css
/* ===== Phase 3 additions ===== */

/* Status bar — one line at the very top, above agent panes */
#status-bar {
    height: 1;
    background: $panel-darken-2;
    color: $text-muted;
    content-align: left middle;
    padding: 0 1;
    dock: top;
}

/* Prompt input bar — one line at the bottom, below agent panes */
#prompt-bar {
    height: 1;
    dock: bottom;
    background: $surface-darken-1;
}

#prompt-bar Input {
    background: $surface-darken-1;
    border: none;
    height: 1;
}

/* Disagreement highlight — pane header changes color when agents disagree */
AgentPane.disagreement #header {
    background: $warning-darken-1;
    color: $text;
}
```

These rules complement the DEFAULT_CSS on the widgets themselves. The `dock: top` on `#status-bar` and `dock: bottom` on `#prompt-bar` ensure they are pinned outside the agent pane scroll area.

Run: `.venv/bin/python -c "from tui.app import AgentBureauApp; print('CSS load OK')"` (import only, do not run the app). This confirms the CSS file parses without syntax errors on import.
  </action>
  <verify>
`.venv/bin/python -c "from tui.app import AgentBureauApp; print('CSS load OK')"` outputs `CSS load OK` without errors. `src/tui/styles.tcss` contains the `AgentPane.disagreement #header` rule.
  </verify>
  <done>styles.tcss contains all Phase 3 CSS rules. Import check succeeds. Commit: `feat(03-03): extend styles.tcss with status bar, prompt bar, and disagreement highlight rules`</done>
</task>

</tasks>

<verification>
- `from tui.widgets import StatusBar, PromptBar` imports cleanly
- `StatusBar.show_hints()`, `show_streaming()`, `show_done()`, `show_classification()` exist
- `PromptBar.compose()` yields an Input with id="prompt-input"
- `styles.tcss` has `#status-bar`, `#prompt-bar`, and `AgentPane.disagreement #header` rules
- Full pytest suite passes (no regressions)
</verification>

<success_criteria>
All four new CSS rules present in styles.tcss. StatusBar and PromptBar importable. Full suite green.
</success_criteria>

<output>
After completion, create `.planning/phases/03-live-streaming-integration/03-03-SUMMARY.md` following the summary template.
</output>
